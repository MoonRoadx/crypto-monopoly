<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Monopoly - Multijoueur</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .setup-screen, .game-screen {
            display: none;
        }

        .setup-screen.active, .game-screen.active {
            display: block;
        }

        .player-setup {
            max-width: 600px;
            margin: 0 auto;
            padding: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .player-list {
            margin: 20px 0;
        }

        .player-item {
            background: #f8f9fa;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        button.secondary {
            background: #6c757d;
        }

        button.danger {
            background: #dc3545;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
            margin-top: 20px;
        }

        .players-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            max-height: 800px;
            overflow-y: auto;
        }

        .player-card {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 3px solid transparent;
        }

        .player-card.active {
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }

        .player-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .player-money {
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
        }

        .player-properties {
            margin-top: 10px;
            font-size: 0.85em;
        }

        .board-container {
            position: relative;
            aspect-ratio: 1;
            max-width: 700px;
            margin: 0 auto;
        }

        .board {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            grid-template-rows: repeat(11, 1fr);
            gap: 0;
            background: #f0f0f0;
            border: 3px solid #333;
        }

        .cell {
            border: 1px solid #333;
            padding: 3px;
            font-size: 0.6em;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: white;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cell:hover {
            background: #f8f9fa;
            z-index: 10;
        }

        .cell.owned {
            background: #e8f5e9;
        }

        .corner {
            font-weight: bold;
            font-size: 0.7em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 5px;
        }

        .color-bar {
            height: 12px;
            width: 100%;
            margin-bottom: 3px;
        }

        .property-name {
            font-weight: bold;
            font-size: 0.7em;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .price {
            font-weight: bold;
            color: #667eea;
            font-size: 0.65em;
        }

        .player-tokens {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 2px;
        }

        .token {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .controls-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            max-height: 800px;
            overflow-y: auto;
        }

        .dice-display {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .dice {
            font-size: 4em;
            margin: 10px;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .game-log {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-left: 3px solid #667eea;
            background: #f8f9fa;
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .property-details {
            margin: 15px 0;
        }

        .property-details div {
            padding: 8px;
            margin-bottom: 5px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .color-legend {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .center-area {
            grid-column: 2 / 11;
            grid-row: 2 / 11;
            background: linear-gradient(135deg, #667eea20 0%, #764ba240 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: none;
        }

        .center-logo {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .current-player-indicator {
            background: #667eea;
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }

        @media (max-width: 1200px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
            
            .board-container {
                order: -1;
            }
        }

        /* Colors for properties */
        .defi { background: #00D9FF; }
        .layer1 { background: #FF6B9D; }
        .nft { background: #FFD93D; }
        .meme { background: #6BCB77; }
        .layer2 { background: #FF8C42; }
        .stable { background: #A8E6CF; }
        .exchange { background: #333; color: white; }
        .protocol { background: #764ba2; color: white; }

        .trade-panel {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .trade-panel select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border: 2px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üöÄ CRYPTO MONOPOLY - MULTIJOUEUR üöÄ</h1>

        <!-- Setup Screen -->
        <div class="setup-screen active">
            <div class="player-setup">
                <h2 style="text-align: center; margin-bottom: 20px;">Configuration de la partie</h2>
                
                <div class="input-group">
                    <label>Nom du joueur</label>
                    <input type="text" id="playerName" placeholder="Entrez votre nom">
                </div>

                <div class="input-group">
                    <label>Couleur</label>
                    <select id="playerColor">
                        <option value="#FF6B6B">üî¥ Rouge</option>
                        <option value="#4ECDC4">üîµ Bleu</option>
                        <option value="#FFD93D">üü° Jaune</option>
                        <option value="#6BCB77">üü¢ Vert</option>
                        <option value="#A8E6CF">ü©µ Cyan</option>
                        <option value="#FF8C42">üü† Orange</option>
                    </select>
                </div>

                <button onclick="addPlayer()" style="width: 100%; margin-bottom: 20px;">‚ûï Ajouter un joueur</button>

                <div class="player-list" id="playerList"></div>

                <button onclick="startGame()" style="width: 100%;">üéÆ D√©marrer la partie</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="game-screen">
            <div class="game-layout">
                <!-- Players Panel -->
                <div class="players-panel">
                    <h3 style="margin-bottom: 15px;">üë• Joueurs</h3>
                    <div id="playersCards"></div>
                </div>

                <!-- Board -->
                <div>
                    <div class="current-player-indicator" id="currentPlayerIndicator"></div>
                    <div class="board-container">
                        <div class="board" id="gameBoard"></div>
                    </div>
                </div>

                <!-- Controls Panel -->
                <div class="controls-panel">
                    <div class="dice-display">
                        <h3>üé≤ D√©s</h3>
                        <div id="diceResult">
                            <span class="dice">‚öÄ</span>
                            <span class="dice">‚öÄ</span>
                        </div>
                        <div id="diceTotal" style="font-size: 1.5em; font-weight: bold; color: #667eea;">-</div>
                    </div>

                    <div class="action-buttons">
                        <button onclick="rollDice()" id="rollButton">üé≤ Lancer les d√©s</button>
                        <button onclick="buyProperty()" id="buyButton" style="display: none;">üí∞ Acheter</button>
                        <button onclick="endTurn()" id="endTurnButton">‚è≠Ô∏è Fin du tour</button>
                        <button onclick="showTradePanel()" class="secondary">üîÑ √âchanger</button>
                        <button onclick="showPlayerProperties()" class="secondary">üè† Mes propri√©t√©s</button>
                    </div>

                    <div class="game-log">
                        <h4 style="margin-bottom: 10px;">üìã Historique</h4>
                        <div id="gameLog"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Property Modal -->
    <div class="modal" id="propertyModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Propri√©t√©</div>
            <div id="modalBody"></div>
            <button onclick="closeModal()" style="width: 100%; margin-top: 20px;">Fermer</button>
        </div>
    </div>

    <!-- Card Modal -->
    <div class="modal" id="cardModal">
        <div class="modal-content">
            <div class="modal-title" id="cardTitle">Carte</div>
            <div id="cardBody" style="font-size: 1.1em; padding: 20px 0;"></div>
            <button onclick="closeCardModal()" style="width: 100%; margin-top: 20px;">OK</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            players: [],
            currentPlayerIndex: 0,
            diceRolled: false,
            properties: [],
            board: []
        };

        // Board definition
        const boardData = [
            // Bottom row (left to right)
            {pos: 0, type: 'corner', name: 'D√âPART', text: 'üí∞ D√âPART\nRecevez 200 USDT'},
            {pos: 1, type: 'property', name: 'AAVE', price: 60, rent: [6, 30, 90, 160, 240, 320], color: 'defi', group: 'DeFi'},
            {pos: 2, type: 'special', name: 'BULL MARKET'},
            {pos: 3, type: 'property', name: 'UNISWAP', price: 60, rent: [6, 30, 90, 160, 240, 320], color: 'defi', group: 'DeFi'},
            {pos: 4, type: 'fee', name: 'MINING FEE', amount: 200},
            {pos: 5, type: 'exchange', name: 'BINANCE', price: 200},
            {pos: 6, type: 'property', name: 'CARDANO', price: 100, rent: [10, 50, 150, 280, 400, 550], color: 'layer1', group: 'Layer 1'},
            {pos: 7, type: 'special', name: 'BEAR MARKET'},
            {pos: 8, type: 'property', name: 'SOLANA', price: 100, rent: [10, 50, 150, 280, 400, 550], color: 'layer1', group: 'Layer 1'},
            {pos: 9, type: 'property', name: 'POLKADOT', price: 120, rent: [12, 60, 180, 320, 480, 640], color: 'layer1', group: 'Layer 1'},
            
            // Right column (bottom to top)
            {pos: 10, type: 'corner', name: 'STAKING', text: 'üÖøÔ∏è STAKING\nRepos gratuit'},
            {pos: 11, type: 'property', name: 'OPENSEA', price: 140, rent: [14, 70, 200, 380, 550, 750], color: 'nft', group: 'NFT'},
            {pos: 12, type: 'property', name: 'BLUR', price: 140, rent: [14, 70, 200, 380, 550, 750], color: 'nft', group: 'NFT'},
            {pos: 13, type: 'protocol', name: 'CHAINLINK', price: 150},
            {pos: 14, type: 'property', name: 'MAGIC EDEN', price: 160, rent: [16, 80, 220, 440, 600, 800], color: 'nft', group: 'NFT'},
            {pos: 15, type: 'exchange', name: 'COINBASE', price: 200},
            {pos: 16, type: 'property', name: 'DOGECOIN', price: 180, rent: [18, 90, 250, 500, 700, 900], color: 'meme', group: 'Meme'},
            {pos: 17, type: 'special', name: 'BULL MARKET'},
            {pos: 18, type: 'property', name: 'SHIBA INU', price: 180, rent: [18, 90, 250, 500, 700, 900], color: 'meme', group: 'Meme'},
            {pos: 19, type: 'property', name: 'PEPE', price: 200, rent: [20, 100, 300, 600, 800, 1000], color: 'meme', group: 'Meme'},
            
            // Top row (right to left)
            {pos: 20, type: 'corner', name: 'SEC AUDIT', text: 'üîí SEC AUDIT\nEn prison'},
            {pos: 21, type: 'property', name: 'POLYGON', price: 220, rent: [22, 110, 330, 650, 900, 1100], color: 'layer2', group: 'Layer 2'},
            {pos: 22, type: 'property', name: 'ARBITRUM', price: 220, rent: [22, 110, 330, 650, 900, 1100], color: 'layer2', group: 'Layer 2'},
            {pos: 23, type: 'special', name: 'BEAR MARKET'},
            {pos: 24, type: 'property', name: 'OPTIMISM', price: 240, rent: [24, 120, 360, 720, 1000, 1200], color: 'layer2', group: 'Layer 2'},
            {pos: 25, type: 'exchange', name: 'KRAKEN', price: 200},
            {pos: 26, type: 'special', name: 'BULL MARKET'},
            {pos: 27, type: 'property', name: 'ETHEREUM', price: 260, rent: [26, 130, 390, 780, 1100, 1300], color: 'stable', group: 'Blue Chips'},
            {pos: 28, type: 'fee', name: 'GAS FEE', amount: 100},
            {pos: 29, type: 'property', name: 'BITCOIN', price: 280, rent: [28, 140, 420, 840, 1200, 1400], color: 'stable', group: 'Blue Chips'},
            
            // Left column (top to bottom)
            {pos: 30, type: 'corner', name: 'RUGPULL', text: 'üö® RUGPULL\nAllez en prison!'},
            {pos: 31, type: 'property', name: 'BNB', price: 300, rent: [30, 150, 450, 900, 1300, 1500], color: 'stable', group: 'Blue Chips'},
            {pos: 32, type: 'protocol', name: 'THE GRAPH', price: 150},
            {pos: 33, type: 'property', name: 'COMPOUND', price: 320, rent: [32, 160, 480, 960, 1400, 1600], color: 'defi', group: 'DeFi'},
            {pos: 34, type: 'property', name: 'MAKER DAO', price: 320, rent: [32, 160, 480, 960, 1400, 1600], color: 'defi', group: 'DeFi'},
            {pos: 35, type: 'exchange', name: 'BYBIT', price: 200},
            {pos: 36, type: 'property', name: 'AVALANCHE', price: 350, rent: [35, 175, 500, 1000, 1500, 1800], color: 'layer1', group: 'Layer 1'},
            {pos: 37, type: 'special', name: 'BEAR MARKET'},
            {pos: 38, type: 'property', name: 'COSMOS', price: 350, rent: [35, 175, 500, 1000, 1500, 1800], color: 'layer1', group: 'Layer 1'},
            {pos: 39, type: 'fee', name: 'MINING FEE', amount: 200}
        ];

        const bullMarketCards = [
            "üöÄ BULL RUN! Bitcoin ATH! Recevez 150 USDT",
            "üíé AIRDROP! Recevez 100 USDT",
            "üìà PUMP +50%! Recevez 200 USDT",
            "üéÅ STAKING REWARDS! Recevez 75 USDT",
            "üî• WHALE ALERT! Recevez 250 USDT",
            "‚ö° LIGHTNING NETWORK! √âconomisez 50 USDT",
            "üåï TO THE MOON! Chaque joueur vous donne 50 USDT",
            "üí∞ YIELD FARMING! Recevez 120 USDT"
        ];

        const bearMarketCards = [
            "üìâ CRASH -30%! Payez 150 USDT",
            "üî¥ RUG PULL! Perdez 200 USDT",
            "‚ö†Ô∏è HACK! Payez 100 USDT",
            "üìú SEC REGULATION! Payez 120 USDT",
            "‚ùå LIQUIDATION! Payez 180 USDT",
            "üêª BEAR MARKET! Payez 80 USDT √† chaque joueur",
            "‚õî NETWORK CONGESTION! Payez 75 USDT",
            "üö´ WALLET COMPROMIS! Payez 90 USDT"
        ];

        // Initialize properties
        gameState.board = boardData.map(cell => ({
            ...cell,
            owner: null,
            nodes: 0
        }));

        function addPlayer() {
            const name = document.getElementById('playerName').value.trim();
            const color = document.getElementById('playerColor').value;

            if (!name) {
                alert('Veuillez entrer un nom');
                return;
            }

            if (gameState.players.length >= 6) {
                alert('Maximum 6 joueurs');
                return;
            }

            gameState.players.push({
                name: name,
                color: color,
                money: 1500,
                position: 0,
                properties: [],
                inJail: false,
                jailTurns: 0
            });

            updatePlayerList();
            document.getElementById('playerName').value = '';
        }

        function updatePlayerList() {
            const list = document.getElementById('playerList');
            list.innerHTML = '<h3 style="margin-bottom: 10px;">Joueurs ajout√©s:</h3>';
            
            gameState.players.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'player-item';
                item.innerHTML = `
                    <div>
                        <span class="player-icon" style="background: ${player.color}"></span>
                        <strong>${player.name}</strong> - ${player.money} USDT
                    </div>
                    <button class="danger" onclick="removePlayer(${index})" style="padding: 5px 10px;">‚ùå</button>
                `;
                list.appendChild(item);
            });
        }

        function removePlayer(index) {
            gameState.players.splice(index, 1);
            updatePlayerList();
        }

        function startGame() {
            if (gameState.players.length < 2) {
                alert('Il faut au moins 2 joueurs pour commencer');
                return;
            }

            document.querySelector('.setup-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');

            initializeBoard();
            updatePlayersDisplay();
            updateCurrentPlayerIndicator();
            addLog('üéÆ La partie commence! ' + gameState.players[0].name + ' commence.');
        }

        function initializeBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';

            // Position mapping for grid layout
            const gridPositions = [
                // Bottom row
                {row: 11, col: 1}, {row: 11, col: 2}, {row: 11, col: 3}, {row: 11, col: 4}, 
                {row: 11, col: 5}, {row: 11, col: 6}, {row: 11, col: 7}, {row: 11, col: 8}, 
                {row: 11, col: 9}, {row: 11, col: 10},
                // Right column
                {row: 11, col: 11}, {row: 10, col: 11}, {row: 9, col: 11}, {row: 8, col: 11},
                {row: 7, col: 11}, {row: 6, col: 11}, {row: 5, col: 11}, {row: 4, col: 11},
                {row: 3, col: 11}, {row: 2, col: 11},
                // Top row
                {row: 1, col: 11}, {row: 1, col: 10}, {row: 1, col: 9}, {row: 1, col: 8},
                {row: 1, col: 7}, {row: 1, col: 6}, {row: 1, col: 5}, {row: 1, col: 4},
                {row: 1, col: 3}, {row: 1, col: 2},
                // Left column
                {row: 1, col: 1}, {row: 2, col: 1}, {row: 3, col: 1}, {row: 4, col: 1},
                {row: 5, col: 1}, {row: 6, col: 1}, {row: 7, col: 1}, {row: 8, col: 1},
                {row: 9, col: 1}, {row: 10, col: 1}
            ];

            gameState.board.forEach((cell, index) => {
                const div = document.createElement('div');
                div.className = 'cell';
                div.style.gridRow = gridPositions[index].row;
                div.style.gridColumn = gridPositions[index].col;
                div.onclick = () => showPropertyInfo(index);

                if (cell.type === 'corner') {
                    div.className += ' corner';
                    div.innerHTML = cell.text.replace('\n', '<br>');
                } else if (cell.type === 'property') {
                    div.innerHTML = `
                        <div class="color-bar ${cell.color}"></div>
                        <div class="property-name">${cell.name}</div>
                        <div class="price">${cell.price} USDT</div>
                    `;
                } else if (cell.type === 'exchange') {
                    div.className += ' exchange';
                    div.innerHTML = `
                        <div class="property-name">üè¶ ${cell.name}</div>
                        <div class="price">${cell.price} USDT</div>
                    `;
                } else if (cell.type === 'protocol') {
                    div.className += ' protocol';
                    div.innerHTML = `
                        <div class="property-name">üîó ${cell.name}</div>
                        <div class="price">${cell.price} USDT</div>
                    `;
                } else if (cell.type === 'special') {
                    div.innerHTML = `<div>${cell.name === 'BULL MARKET' ? 'üìä' : 'üìâ'}<br>${cell.name}</div>`;
                } else if (cell.type === 'fee') {
                    div.innerHTML = `<div>‚õèÔ∏è<br>${cell.name}<br>Payez ${cell.amount} USDT</div>`;
                }

                div.id = `cell-${index}`;
                board.appendChild(div);
            });

            // Add center area
            const center = document.createElement('div');
            center.className = 'center-area';
            center.innerHTML = '<div class="center-logo">‚Çø CRYPTO<br>MONOPOLY ‚Çø</div>';
            board.appendChild(center);

            updatePlayerPositions();
        }

        function updatePlayerPositions() {
            // Clear all tokens first
            document.querySelectorAll('.player-tokens').forEach(el => el.remove());

            // Group players by position
            const positionMap = {};
            gameState.players.forEach((player, index) => {
                if (!positionMap[player.position]) {
                    positionMap[player.position] = [];
                }
                positionMap[player.position].push({...player, index});
            });

            // Add tokens to cells
            Object.entries(positionMap).forEach(([pos, players]) => {
                const cell = document.getElementById(`cell-${pos}`);
                if (cell) {
                    const tokensDiv = document.createElement('div');
                    tokensDiv.className = 'player-tokens';
                    players.forEach(player => {
                        const token = document.createElement('div');
                        token.className = 'token';
                        token.style.background = player.color;
                        token.title = player.name;
                        tokensDiv.appendChild(token);
                    });
                    cell.appendChild(tokensDiv);
                }
            });
        }

        function updatePlayersDisplay() {
            const container = document.getElementById('playersCards');
            container.innerHTML = '';

            gameState.players.forEach((player, index) => {
                const card = document.createElement('div');
                card.className = 'player-card' + (index === gameState.currentPlayerIndex ? ' active' : '');
                card.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="player-icon" style="background: ${player.color}"></span>
                        <div>
                            <div class="player-name">${player.name}</div>
                            <div class="player-money">${player.money} USDT</div>
                        </div>
                    </div>
                    <div class="player-properties">
                        üè† ${player.properties.length} propri√©t√©s
                        ${player.inJail ? '<br>üîí En prison' : ''}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function updateCurrentPlayerIndicator() {
            const player = gameState.players[gameState.currentPlayerIndex];
            document.getElementById('currentPlayerIndicator').innerHTML = 
                `üéØ Tour de <strong>${player.name}</strong>`;
        }

        function rollDice() {
            if (gameState.diceRolled) {
                alert('Vous avez d√©j√† lanc√© les d√©s ce tour!');
                return;
            }

            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;

            const diceSymbols = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
            document.querySelector('#diceResult').innerHTML = `
                <span class="dice">${diceSymbols[dice1-1]}</span>
                <span class="dice">${diceSymbols[dice2-1]}</span>
            `;
            document.getElementById('diceTotal').textContent = `Total: ${total}`;

            gameState.diceRolled = true;

            const player = gameState.players[gameState.currentPlayerIndex];
            
            if (player.inJail) {
                if (dice1 === dice2) {
                    player.inJail = false;
                    player.jailTurns = 0;
                    addLog(`${player.name} sort de prison avec un double!`);
                    movePlayer(total);
                } else {
                    player.jailTurns++;
                    if (player.jailTurns >= 3) {
                        player.inJail = false;
                        player.jailTurns = 0;
                        player.money -= 50;
                        addLog(`${player.name} paie 50 USDT pour sortir de prison`);
                        movePlayer(total);
                    } else {
                        addLog(`${player.name} reste en prison (tour ${player.jailTurns}/3)`);
                    }
                }
            } else {
                movePlayer(total);
            }

            updatePlayersDisplay();
        }

        function movePlayer(steps) {
            const player = gameState.players[gameState.currentPlayerIndex];
            const oldPosition = player.position;
            player.position = (player.position + steps) % 40;

            // Check if passed START
            if (player.position < oldPosition) {
                player.money += 200;
                addLog(`${player.name} passe par D√âPART et re√ßoit 200 USDT! üí∞`);
            }

            updatePlayerPositions();
            handleLanding(player.position);
        }

        function handleLanding(position) {
            const cell = gameState.board[position];
            const player = gameState.players[gameState.currentPlayerIndex];

            addLog(`${player.name} arrive sur ${cell.name}`);

            if (cell.type === 'property' || cell.type === 'exchange' || cell.type === 'protocol') {
                if (cell.owner === null) {
                    document.getElementById('buyButton').style.display = 'block';
                    showPropertyInfo(position);
                } else if (cell.owner !== gameState.currentPlayerIndex) {
                    payRent(position);
                }
            } else if (cell.type === 'special') {
                if (cell.name === 'BULL MARKET') {
                    drawCard('bull');
                } else if (cell.name === 'BEAR MARKET') {
                    drawCard('bear');
                }
            } else if (cell.type === 'fee') {
                player.money -= cell.amount;
                addLog(`${player.name} paie ${cell.amount} USDT de frais`);
                updatePlayersDisplay();
            } else if (cell.name === 'RUGPULL') {
                player.position = 20; // SEC AUDIT position
                player.inJail = true;
                player.jailTurns = 0;
                addLog(`${player.name} va en prison! üîí`);
                updatePlayerPositions();
            }
        }

        function buyProperty() {
            const player = gameState.players[gameState.currentPlayerIndex];
            const cell = gameState.board[player.position];

            if (player.money < cell.price) {
                alert('Vous n\'avez pas assez d\'argent!');
                return;
            }

            player.money -= cell.price;
            cell.owner = gameState.currentPlayerIndex;
            player.properties.push(player.position);

            addLog(`${player.name} ach√®te ${cell.name} pour ${cell.price} USDT! üè†`);
            
            document.getElementById('buyButton').style.display = 'none';
            updatePlayersDisplay();
            closeModal();
        }

        function payRent(position) {
            const cell = gameState.board[position];
            const player = gameState.players[gameState.currentPlayerIndex];
            const owner = gameState.players[cell.owner];

            let rent = 0;

            if (cell.type === 'property') {
                rent = cell.rent[cell.nodes];
                // Check for monopoly
                const group = gameState.board.filter(c => c.group === cell.group);
                const ownedByOwner = group.filter(c => c.owner === cell.owner).length;
                if (ownedByOwner === group.length && cell.nodes === 0) {
                    rent *= 2; // Double rent for monopoly
                }
            } else if (cell.type === 'exchange') {
                const exchangesOwned = gameState.board.filter(c => 
                    c.type === 'exchange' && c.owner === cell.owner
                ).length;
                rent = [25, 50, 100, 200][exchangesOwned - 1];
            } else if (cell.type === 'protocol') {
                const protocolsOwned = gameState.board.filter(c => 
                    c.type === 'protocol' && c.owner === cell.owner
                ).length;
                const diceTotal = parseInt(document.getElementById('diceTotal').textContent.split(': ')[1]);
                rent = diceTotal * (protocolsOwned === 2 ? 10 : 4);
            }

            player.money -= rent;
            owner.money += rent;

            addLog(`${player.name} paie ${rent} USDT de loyer √† ${owner.name}`);
            updatePlayersDisplay();
        }

        function drawCard(type) {
            const cards = type === 'bull' ? bullMarketCards : bearMarketCards;
            const card = cards[Math.floor(Math.random() * cards.length)];
            
            const player = gameState.players[gameState.currentPlayerIndex];
            
            // Parse card effect
            const moneyMatch = card.match(/(\d+)\s*USDT/);
            if (moneyMatch) {
                const amount = parseInt(moneyMatch[1]);
                if (card.includes('Recevez') || card.includes('√âconomisez')) {
                    player.money += amount;
                } else if (card.includes('Payez') || card.includes('Perdez')) {
                    player.money -= amount;
                }
            }

            if (card.includes('Chaque joueur vous donne')) {
                gameState.players.forEach((p, i) => {
                    if (i !== gameState.currentPlayerIndex) {
                        p.money -= 50;
                        player.money += 50;
                    }
                });
            } else if (card.includes('Payez') && card.includes('√† chaque joueur')) {
                gameState.players.forEach((p, i) => {
                    if (i !== gameState.currentPlayerIndex) {
                        player.money -= 80;
                        p.money += 80;
                    }
                });
            }

            document.getElementById('cardTitle').textContent = 
                type === 'bull' ? 'üìä BULL MARKET' : 'üìâ BEAR MARKET';
            document.getElementById('cardBody').textContent = card;
            document.getElementById('cardModal').classList.add('show');

            addLog(`${player.name} tire une carte: ${card}`);
            updatePlayersDisplay();
        }

        function showPropertyInfo(position) {
            const cell = gameState.board[position];
            
            if (!cell.price) return;

            let content = `<div class="property-details">`;
            content += `<div><strong>Prix:</strong> ${cell.price} USDT</div>`;
            
            if (cell.owner !== null) {
                const owner = gameState.players[cell.owner];
                content += `<div><strong>Propri√©taire:</strong> ${owner.name}</div>`;
            } else {
                content += `<div><strong>Statut:</strong> Disponible</div>`;
            }

            if (cell.rent) {
                content += `<div><strong>Loyer de base:</strong> ${cell.rent[0]} USDT</div>`;
                content += `<div><strong>Avec 1 node:</strong> ${cell.rent[1]} USDT</div>`;
                content += `<div><strong>Avec 2 nodes:</strong> ${cell.rent[2]} USDT</div>`;
                content += `<div><strong>Avec 3 nodes:</strong> ${cell.rent[3]} USDT</div>`;
                content += `<div><strong>Avec 4 nodes:</strong> ${cell.rent[4]} USDT</div>`;
                content += `<div><strong>Avec 5 nodes:</strong> ${cell.rent[5]} USDT</div>`;
                content += `<div><strong>Prix d'un node:</strong> ${Math.floor(cell.price * 0.5)} USDT</div>`;
            }

            if (cell.group) {
                content += `<div><strong>Groupe:</strong> ${cell.group}</div>`;
            }

            content += `</div>`;

            document.getElementById('modalTitle').textContent = cell.name;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('propertyModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('propertyModal').classList.remove('show');
        }

        function closeCardModal() {
            document.getElementById('cardModal').classList.remove('show');
        }

        function endTurn() {
            gameState.diceRolled = false;
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
            
            document.getElementById('buyButton').style.display = 'none';
            document.querySelector('#diceResult').innerHTML = `
                <span class="dice">‚öÄ</span>
                <span class="dice">‚öÄ</span>
            `;
            document.getElementById('diceTotal').textContent = '-';

            updatePlayersDisplay();
            updateCurrentPlayerIndicator();
            addLog(`C'est au tour de ${gameState.players[gameState.currentPlayerIndex].name}`);
        }

        function showPlayerProperties() {
            const player = gameState.players[gameState.currentPlayerIndex];
            
            let content = `<div class="property-details">`;
            content += `<div><strong>Argent:</strong> ${player.money} USDT</div>`;
            content += `<div><strong>Nombre de propri√©t√©s:</strong> ${player.properties.length}</div>`;
            
            if (player.properties.length > 0) {
                content += `<h4 style="margin-top: 15px;">Vos propri√©t√©s:</h4>`;
                player.properties.forEach(pos => {
                    const cell = gameState.board[pos];
                    content += `<div>‚Ä¢ ${cell.name} (${cell.price} USDT)</div>`;
                });
            }

            content += `</div>`;

            document.getElementById('modalTitle').textContent = `Propri√©t√©s de ${player.name}`;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('propertyModal').classList.add('show');
        }

        function showTradePanel() {
            alert('Fonctionnalit√© d\'√©change √† venir! Pour l\'instant, n√©gociez entre vous. ü§ù');
        }

        function addLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            log.insertBefore(entry, log.firstChild);

            // Keep only last 10 entries
            while (log.children.length > 10) {
                log.removeChild(log.lastChild);
            }
        }
    </script>
</body>
</html>
